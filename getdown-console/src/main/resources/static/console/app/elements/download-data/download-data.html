<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="download-data">
	<style>
		:host {
			display: none;
		}
	</style>
	<template>

		<config-data
				host="{{host}}"
		>
		</config-data>

		<ws-client  id="ws"
					url="{{host}}/ws"
		            topic="/downloads/jobStateChange"
		            on-message="_handleJobChange">
		</ws-client>

		<iron-ajax id="ajaxall"
		           handle-as="json"
		           content-type="application/json"
		           method="GET"
		           last-response="{{all}}"
		           debounce-duration="3000"
		           url="{{host}}/download/list"
		           on-response="_logresponse">
		</iron-ajax>


		<iron-ajax id="ajaxwaiting"
		           handle-as="json"
		           content-type="application/json"
		           method="GET"
		           last-response="{{waiting}}"
		           debounce-duration="3000"
		           url="{{host}}/download/state/waiting"
		           on-response="_logresponse">
		</iron-ajax>


		<iron-ajax id="ajaxactive"
		           handle-as="json"
		           content-type="application/json"
		           method="GET"
		           last-response="{{active}}"
		           debounce-duration="3000"
		           url="{{host}}/download/state/running"
		           on-response="_logresponse">
		</iron-ajax>


		<iron-ajax id="ajaxfinished"
		           handle-as="json"
		           content-type="application/json"
		           method="GET"
		           last-response="{{finished}}"
		           debounce-duration="3000"
		           url="{{host}}/download/state/finished"
		           on-response="_logresponse">
		</iron-ajax>


		<iron-ajax id="ajaxfailed"
		           handle-as="json"
		           content-type="application/json"
		           method="GET"
		           last-response="{{failed}}"
		           debounce-duration="3000"
		           url="{{host}}/download/state/error"
		           on-response="_logresponse">
		</iron-ajax>

	</template>
	<script>
		(function () {
			'use strict';

			Polymer({
				is: 'download-data',

				properties: {
					active: {
						type: Array,
						notify: true
					},
					waiting: {
						type: Array,
						notify: true
					},
					failed: {
						type: Array,
						notify: true
					},
					finished: {
						type: Array,
						notify: true
					},
					all: {
						type: Array,
						notify: true
					},
					host: {
						type: String,
						notify: true
					}

				},
				reloadActive :function(){
					this.$.ajaxactive.generateRequest();
				},
				reloadWaiting :function(){
					this.$.ajaxwaiting.generateRequest();
				},
				reloadFinished :function(){
					this.$.ajaxfinished.generateRequest();
				},
				reloadFailed :function(){
					this.$.ajaxfailed.generateRequest();
				},
				reloadAll :function(){
					this.$.ajaxall.generateRequest();
				},
				reload :function(){
					this.reloadActive();
					this.reloadWaiting();
					this.reloadFinished();
					this.reloadFailed();
					this.reloadAll();
					this.$.ws.connect();
				},
				_logresponse  :function(request) {
					console.log(request.detail.response);
				},
				_handleJobChange: function (event) {
					this.reloadActive();
				}
			});
		})();
	</script>
</dom-module>
