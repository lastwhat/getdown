package io.github.lumue.getdown.hosts.streamcloud;

import static org.junit.Assert.*;

import org.junit.Test;

import com.fasterxml.jackson.core.JsonProcessingException;

public class StreamcloudScraperTest {
	
	private final static String PAGE_CONTENT="<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\"  \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\"><head>  	<meta name=\"robots\" content=\"noarchive\"/>	<meta name=\"GOOGLEBOT\" content=\"NOARCHIVE\">	<meta name=\"GOOGLEBOT\" content=\"NOSNIPPET\">	<script type=\"text/javascript\">		if (top.location != self.location) {			top.location = self.location.href;		}	</script>			<meta http-equiv=\"X-UA-Compatible\" content=\"requiresActiveX=true\" />		<meta name=\"robots\" content=\"noindex\">		<meta name=\"description\" content=\"Streamcloud = Video Sharing + Cloud at its best\" />	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />	<link rel=\"stylesheet\" type=\"text/css\" href=\"http://streamcloud.eu/stylesheets/styles.css?1=3\" />	<link rel=\"stylesheet\" type=\"text/css\" href=\"http://streamcloud.eu/control.css\" media=\"screen\" />		<script type=\"text/javascript\" src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js\"></script>	<script type=\"text/javascript\" src=\"http://streamcloud.eu/xupload.js\"></script>	<script type=\"text/javascript\" src=\"http://streamcloud.eu/js/jquery.cookie.js\"></script>	<script type=\"text/javascript\" src=\"http://streamcloud.eu/js/bootstrap.min.js\"></script>		<title>Streamcloud: Easy way to share your files</title>	<link rel=\"icon\" href=\"http://streamcloud.eu/favicon.ico\" type=\"image/x-icon\">						</head><body>	<script type=\"text/javascript\">		if(top != self) top.location.replace(location);	</script>			<div id=\"javawarning\" style=\"display: none; height: 30px; background-color: #f2dede; border-bottom: 1px solid #eed3d7;\">			<div style=\"width: 960px;margin: 0 auto;position: relative; color: #b94a48; font-size: 14px; padding-top: 7px;\">				<strong>Warning</strong>, your browser has Java installed. Therefore your computer may be vulnerable to malware when browsing the web. <a href=\"/java.html\">Disable Java now &raquo;</a>			</div>		</div>				<script type=\"text/javascript\">		jQuery(function($) {			if ($.browser.chrome || $.browser.mozilla) {				for (var i = 0; i < navigator.plugins.length; i++) {					if (/^Java/.test(navigator.plugins[i].name)) {						$('#javawarning').show();					}				}			}						if ($.browser.msie) {				$('body').append('<' + 'object classid=\"clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA\" ' + 'id=\"deployJavaPlugin\" width=\"0\" height=\"0\">' + '<' + '/' + 'object' + '>');				var plugin = document.getElementById('deployJavaPlugin');				if(plugin.version) {					$('#javawarning').show();				}			}					});		</script>				<div id=\"header\">		<div class=\"page\">			<a href=\"http://streamcloud.eu\" class=\"logo\">Streamcloud</a>			<ul>									  						  <li><a href=\"http://streamcloud.eu/reward.html\">Make money</a></li>						  <li><a href=\"http://streamcloud.eu/login.html\">Login</a></li>						  <li><a href=\"http://streamcloud.eu/?op=registration\">Sign Up</a></li>						  <li><a href=\"http://streamcloud.eu/?op=forgot_pass\">Forgot your password?</a></li>					  							</ul>			<div class=\"clear\"></div>		</div>	</div>							<!--			<div style=\"margin: -33px auto 33px auto; background-image: url('/images_2/mobile_t.png'); display: block; width: 964px; height: 52px; border: 0; padding: 0;\">				&nbsp;			</div>			-->					<div id=\"page\">		<div class=\"top\"></div>		<div class=\"content\">						<div style=\"height: 50px; vertical-align: middle;\" class=\"header page\">				<h1 style=\"overflow: hidden; width: 650px; height: 24px;line-height: 24px; font-size: 18px;\">How I Met Your Mother S01E01 Verliebt verlobt versagt GERMAN DL 720p HDTV x264-iND</h1>				<ul>											<li class=\"active\"><a href=\"javascript:void(0);\">Stream</a></li>						<li><a href=\"http://www.FriendlyDuck.com/AF_TA/rel/index.cfm?RST=UNF&TAD=427329\">Download</a></li>									</ul>			</div>						<div class=\"padding\">								<div class=\"standout\" id=\"player_code\">					<div id='mediaplayer'>&nbsp;</div><script type='text/javascript' src='http://streamcloud.eu/player/jwplayer.js'></script><script type=\"text/javascript\">jwplayer.key='nkfZJmUHTV7xLBszliwZhbXhoB3CdvWqcZFREA==';</script><script type='text/javascript'>jwplayer(\"mediaplayer\").setup({	provider: \"http\",	flashplayer: \"http://streamcloud.eu/player/player.swf\",	file: \"http://cdn4.streamcloud.eu:8080/63v75q3enooax3ptxy4ypuh2w6vnigsshe77zl6vmvuphsxvv6gbvozbxe/video.mp4\",	image: \"http://stor21.streamcloud.eu:8080/i/01/00368/errrgfaao1vn.jpg\",	height: 537,	width: 900,	abouttext: \"Help\",	aboutlink: \"http://streamcloud.eu//playerhelp.html\",	startparam: \"start\",//	skin: \"http://streamcloud.eu/player/skin.xml\",	});(function ($) {	jwplayer().onBeforePlay(function(x) {		$.ajax({			type: \"GET\",			url: \"http://meta.streamcloud.eu/4588292/603a2206c51b19af6fd7523ef1f8fbe1/\"		});	});	jwplayer().onReady(function(x){		$('li#'+jwplayer().getRenderingMode()).addClass('active');	});})(jQuery);</script><br>				</div>																					<div id=\"vmenubar\" class=\"navbar navbar-default\" role=\"navigation\">						<div class=\"container-fluid\">							<div class=\"navbar-collapse collapse\">								<div style=\"float: left; width: 300px; padding: 0; margin: 9px 0 0 0;\" class=\"addthis_toolbox addthis_default_style addthis_32x32_style\">									<a class=\"addthis_button_preferred_1\"></a>									<a class=\"addthis_button_preferred_2\"></a>									<a class=\"addthis_button_preferred_3\"></a>									<a class=\"addthis_button_preferred_4\"></a>									<a class=\"addthis_button_compact\"></a>									<a class=\"addthis_counter addthis_bubble_style\"></a>								</div>								<script type=\"text/javascript\" src=\"http://s7.addthis.com/js/250/addthis_widget.js#async=1\"></script>								<ul class=\"button-standout nav navbar-nav navbar-right\">									<li><a href=\"/playerhelp.html\">Help</a></li>									<li class=\"dropdown\">										<a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">Video player <b class=\"caret\"></b></a>										<ul class=\"dropdown-menu\">											<li class=\"dropdown-header\">Choose your player</li>											<li id=\"html5\" class=\"pselect\"><a href=\"javascript:void(0);\" title=\"Select this player for best experience on your computer or mobile devices\">HTML 5</a></li>											<li id=\"flash\" class=\"pselect\"><a href=\"javascript:void(0);\" title=\"Select Flash if you are having trouble with the default player\">Flash</a></li>										</ul>									</li>																		<li id=\"disable_dark\"><a href=\"javascript:void(0);\">Lights on</a></li>									<li id=\"enable_dark\"><a href=\"javascript:void(0);\">Lights off</a></li>								</ul>							</div>						</div>					</div>																			</div>									<!--<script type=\"text/javascript\" language=\"javascript\" charset=\"utf-8\" src=\"http://adspaces.ero-advertising.com/adspace/154908.js\"></script>-->			<script type=\"text/javascript\" src=\"http://meta.streamcloud.eu/serve.php?adzone=ipv\"></script> 					</div>		<div class=\"bottom\"></div>	</div>		<div id=\"footer\" class=\"page\">		<p>&nbsp;</p>		<ul>			<li><a href=\"http://streamcloud.eu\">Home</a></li>			<li><a href=\"http://streamcloud.eu/reward.html\">Make money</a></li>			<li><a href=\"http://streamcloud.eu/?op=news\">News</a></li>						<li><a href=\"http://streamcloud.eu/faq.html\">FAQ</a></li>			<li><a href=\"http://streamcloud.eu/tos.html\">Terms of service</a></li>			<li><a href=\"http://streamcloud.eu/checkfiles.html\">Link Checker</a></li>			<li><a href=\"http://streamcloud.eu/contact.html\">Contact Us</a></li>		</ul>		<div class=\"clear\"></div>	</div>				<div id=\"the_lights\">		</div>		<!--<script type='text/javascript' src='http://propellerpops.com/apu.php?zoneid=3291&plim=1080'></script>-->		<script type=\"text/javascript\" src=\"http://meta.streamcloud.eu/serve.php?adzone=ppv\"></script> 				<script type=\"text/javascript\">			/*			//if (typeof $.cookies.get('hview') !== 'string') {			if (typeof $.cookie('hview') !== 'string') {				document.write('<div id=\"o36n2FK4\" name=\"o36n2FK4\" onclick=\"WSM8xQeBfdht();\" style=\"padding:0px; margin:0px; border: 0; position:absolute; height: 95%; width:95%; top: 1px; left: 1px; bottom: 1px; right: 1px; z-index: 1000;display:block;\">&nbsp;</div>');			}			function WSM8xQeBfdht(){				var today = new Date(); 				var expiry = new Date(today.getTime() + 4 * 60 * 1000);				document.getElementById('o36n2FK4').style.display = 'none';				//$.cookies.set('hview', 'J7td1EFAWg', { expiresAt: expiry });				$.cookie('hview', 'J7td1EFAWg', { expires: expiry, path: '/', domain: 'streamcloud.eu'});				//jwplayer().play();				settings='scrollbars=yes,status=no,menubar=no,toolbar=no,resizable=yes,width='+screen.width+',height='+screen.height;				win=window.open(\"http://onclickads.net/afu.php?zoneid=3291\", \"J7td1EFAWg\",settings);				window.setTimeout(window.focus, 500);				if (win) {					win.blur();					if (parseInt(navigator.appVersion) >= 4) var x = win.window.open(\"about:blank\").close();					window.focus();				}			}			*/									(function($){				$('#disable_dark').click(function () {					$('#the_lights').fadeTo(0, 0);					$('#the_lights').hide();					$('#disable_dark').hide();					$('#enable_dark').show();				});				$('#enable_dark').click(function () {						$('#the_lights').css({ 'display': 'block', 'height': $(document).height()}); 					$('#the_lights').fadeTo(0, 0.9);					$('#disable_dark>a').css({ 'color': '#ffffff' });					$('#enable_dark').hide();					$('#disable_dark').show();				});								$('.pselect').click(function () {					var mode = $(this).attr('id');					$.cookie('playermode', mode, { expires: 7 , path: '/', domain: 'streamcloud.eu'});					location.reload();				});								setTimeout(function(){					addthis.init();				}, 4000);							})(jQuery);		</script>			<script type=\"text/javascript\">		var _gaq = _gaq || [];		_gaq.push(['_setSiteSpeedSampleRate', 5]);		_gaq.push(['_gat._anonymizeIp']);		_gaq.push(['_setAccount', 'UA-29293498-1']);		_gaq.push(['_trackPageview']);		(function() {			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);		})();	</script></body></html>\n" ;

	private final static String EXPECTED="http://cdn4.streamcloud.eu:8080/63v75q3enooax3ptxy4ypuh2w6vnigsshe77zl6vmvuphsxvv6gbvozbxe/video.mp4";
	
	@Test
	public void testScrapePageContentForDownloadUrl() throws JsonProcessingException {
		assertEquals(EXPECTED,StreamcloudPageScraper.scrapePageContentForDownloadUrl(PAGE_CONTENT));
	}

}
